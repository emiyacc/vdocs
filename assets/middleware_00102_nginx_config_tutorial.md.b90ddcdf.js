import{_ as s,o as n,c as a,Q as l}from"./chunks/framework.eabe3503.js";const u=JSON.parse('{"title":"nginxé…ç½®è¯¦è§£","description":"","frontmatter":{"title":"nginxé…ç½®è¯¦è§£","createTime":"2024/02/04 17:41:14","updateTime":"2024/02/17 22:06:12","isPublished":true,"tags":["nginx"]},"headers":[],"relativePath":"middleware/00102_nginx_config_tutorial.md","filePath":"middleware/00102_nginx_config_tutorial.md"}'),p={name:"middleware/00102_nginx_config_tutorial.md"},e=l(`<p>è¯¦æƒ…è¯·å‚è€ƒğŸ‘‰ <a href="https://nginx.org/en/docs/" target="_blank" rel="noreferrer">nginxå®˜æ–¹æ–‡æ¡£</a></p><h2 id="nginxé…ç½®æ–‡ä»¶ç»“æ„" tabindex="-1">nginxé…ç½®æ–‡ä»¶ç»“æ„ <a class="header-anchor" href="#nginxé…ç½®æ–‡ä»¶ç»“æ„" aria-label="Permalink to &quot;nginxé…ç½®æ–‡ä»¶ç»“æ„&quot;">â€‹</a></h2><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># mainå—</span></span>
<span class="line"><span style="color:#82AAFF;">...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># eventså—</span></span>
<span class="line"><span style="color:#FFCB6B;">events</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#82AAFF;">...</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># mailå—</span></span>
<span class="line"><span style="color:#FFCB6B;">mail</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#82AAFF;">...</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># serverå—</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">server</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#82AAFF;">...</span></span>
<span class="line"><span style="color:#BABED8;">    }</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># streamå—</span></span>
<span class="line"><span style="color:#FFCB6B;">stream</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#82AAFF;">...</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># upstreamå—, å¯ä»¥æœ‰å¤šä¸ª</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">upstream</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#82AAFF;">....</span></span>
<span class="line"><span style="color:#BABED8;">    }</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># serverå—, å¯ä»¥æœ‰å¤šä¸ª</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">server</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#82AAFF;">...</span></span>
<span class="line"><span style="color:#BABED8;">    }</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># httpå—</span></span>
<span class="line"><span style="color:#FFCB6B;">http</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#82AAFF;">...</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># upstreamå—, å¯ä»¥æœ‰å¤šä¸ª</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">upstream</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#82AAFF;">...</span></span>
<span class="line"><span style="color:#BABED8;">    }</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># serverå—, å¯ä»¥æœ‰å¤šä¸ª</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">server</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#82AAFF;">...</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#676E95;font-style:italic;"># locationå—, å¯ä»¥æœ‰å¤šä¸ª</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#FFCB6B;">location</span><span style="color:#BABED8;"> [pattern] </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">            </span><span style="color:#82AAFF;">...</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#BABED8;">    }</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><ul><li>mainï¼šæä¾›äº†<code>nginx</code>æœåŠ¡è¿è¡Œçš„åŸºæœ¬åŠŸèƒ½, åŒ…æ‹¬è¿›ç¨‹ç®¡ç†ã€<code>cpu</code>äº²ç¼˜æ€§ã€å†…å­˜ç®¡ç†ã€é…ç½®æ–‡ä»¶è§£æã€æ—¥å¿—ç®¡ç†ç­‰</li><li>eventså—ï¼šè´Ÿè´£è¿›è¡Œè¿æ¥å¤„ç†, æä¾›å¯¹ä¸åŒæ“ä½œç³»ç»Ÿçš„<code>I/O</code>ç½‘ç»œæ¨¡å‹æ”¯æŒï¼Œ è‡ªåŠ¨æ ¹æ®æ“ä½œç³»ç»Ÿé€‰æ‹©æœ€æœ‰æ•ˆçš„<code>I/O</code>ç½‘ç»œæ¨¡å‹ã€‚</li><li>mailå—ï¼šæä¾›é‚®ä»¶ä»£ç†åŠŸèƒ½ <ul><li>server</li></ul></li><li>streamå—ï¼šæä¾›<code>tcp</code>å’Œ<code>udp</code>ä¼šè¯çš„ä»£ç†å’Œè´Ÿè½½ç›¸å…³åŠŸèƒ½ <ul><li>upstream</li><li>server</li></ul></li><li>httpå—ï¼šæä¾›<code>http</code>å¤„ç†çš„æ ¸å¿ƒåŠŸèƒ½å’Œéƒ¨åˆ†åŠŸèƒ½æ¨¡å— <ul><li>upstream</li><li>server <ul><li>location</li></ul></li></ul></li></ul><h2 id="nginxå¸¸ç”¨å˜é‡" tabindex="-1">nginxå¸¸ç”¨å˜é‡ <a class="header-anchor" href="#nginxå¸¸ç”¨å˜é‡" aria-label="Permalink to &quot;nginxå¸¸ç”¨å˜é‡&quot;">â€‹</a></h2><table><thead><tr><th style="text-align:left;">å˜é‡å</th><th style="text-align:left;">åŠŸèƒ½</th></tr></thead><tbody><tr><td style="text-align:left;"><code>$arg_</code></td><td style="text-align:left;">è·å–æŒ‡å®šè¯·æ±‚å‚æ•°çš„å€¼, ä¾‹å¦‚<code>?key=100</code>, <code>$arg_key=100</code></td></tr><tr><td style="text-align:left;"><code>$args</code></td><td style="text-align:left;">è·å–æ‰€æœ‰çš„è¯·æ±‚å‚æ•°</td></tr><tr><td style="text-align:left;"><code>$connection</code></td><td style="text-align:left;">è¿æ¥çš„åºåˆ—å·</td></tr><tr><td style="text-align:left;"><code>$connection_requests</code></td><td style="text-align:left;">å½“å‰è¿æ¥æ•°</td></tr><tr><td style="text-align:left;"><code>$connection_time</code></td><td style="text-align:left;">å»ºç«‹è¿æ¥çš„æ—¶é—´(å•ä½ç§’)</td></tr><tr><td style="text-align:left;"><code>$content_length</code></td><td style="text-align:left;">è¯·æ±‚å¤´çš„<code>Content-Length</code>å­—æ®µ</td></tr><tr><td style="text-align:left;"><code>$content_type</code></td><td style="text-align:left;">è¯·æ±‚å¤´çš„<code>Content-Type</code>å­—æ®µ</td></tr><tr><td style="text-align:left;"><code>$host</code></td><td style="text-align:left;">ä¾æ¬¡è·å–è¯·æ±‚ä¿¡æ¯ä¸­çš„ä¸»æœºåã€è¯·æ±‚å¤´ä¸­çš„<code>host</code>å­—æ®µã€ä¸è¯·æ±‚åŒ¹é…çš„æœåŠ¡å™¨å; ä¸åŒ…å«ç«¯å£</td></tr><tr><td style="text-align:left;"><code>$http_</code></td><td style="text-align:left;">è·å–httpç›¸å…³çš„ä¿¡æ¯; ä¾‹å¦‚<code>$http_user_agent</code>, <code>$http_cookie</code></td></tr><tr><td style="text-align:left;"><code>$remote_addr</code></td><td style="text-align:left;">å®¢æˆ·ç«¯ip</td></tr><tr><td style="text-align:left;"><code>$remote_port</code></td><td style="text-align:left;">å®¢æˆ·ç«¯ç«¯å£</td></tr><tr><td style="text-align:left;"><code>$request</code></td><td style="text-align:left;">å®Œæ•´çš„åŸå§‹è¯·æ±‚, ä¾‹å¦‚<code>POST /t01?cname=tom&amp;age=12 HTTP/1.1</code></td></tr><tr><td style="text-align:left;"><code>$request_length</code></td><td style="text-align:left;">è¯·æ±‚é•¿åº¦, åŒ…æ‹¬è¯·æ±‚è·¯å¾„ã€è¯·æ±‚å¤´ã€è¯·æ±‚ä½“</td></tr><tr><td style="text-align:left;"><code>$request_method</code></td><td style="text-align:left;">è¯·æ±‚æ–¹æ³•</td></tr><tr><td style="text-align:left;"><code>$request_time</code></td><td style="text-align:left;">è¯·æ±‚å¤„ç†æ—¶é—´(å•ä½: ç§’), åŒ…æ‹¬<code>nginx</code>æœåŠ¡ä»å‘èµ·è¯·æ±‚çš„å®¢æˆ·ç«¯è·å–åˆ°ç¬¬ä¸€ä¸ªå­—èŠ‚å¼€å§‹ï¼Œåˆ°è¿”å›ç»™å®¢æˆ·ç«¯æœ€åä¸€ä¸ªå­—èŠ‚åç»è¿‡çš„æ—¶é—´</td></tr><tr><td style="text-align:left;"><code>$request_uri</code></td><td style="text-align:left;">å¸¦å‚æ•°çš„å®Œæ•´çš„uri; ä¾‹å¦‚ <code>/t01?cname=tom&amp;age=12</code></td></tr><tr><td style="text-align:left;"><code>$scheme</code></td><td style="text-align:left;">è¯·æ±‚åè®®</td></tr><tr><td style="text-align:left;"><code>$upstream_addr</code></td><td style="text-align:left;"><code>nginx</code>è½¬å‘ç»™åç«¯æœåŠ¡èŠ‚ç‚¹çš„åœ°å€, å³çœŸæ­£å¤„ç†è¯·æ±‚çš„æœåŠ¡å™¨åœ°å€</td></tr><tr><td style="text-align:left;"><code>$upstream_bytes_received</code></td><td style="text-align:left;">ä»åç«¯æœåŠ¡å™¨æ”¶åˆ°çš„å­—èŠ‚æ•°</td></tr><tr><td style="text-align:left;"><code>$upstream_bytes_sent</code></td><td style="text-align:left;">å‘é€ç»™åç«¯æœåŠ¡å™¨çš„å­—èŠ‚æ•°</td></tr><tr><td style="text-align:left;"><code>$upstream_connect_time</code></td><td style="text-align:left;">å’Œåç«¯æœåŠ¡å™¨å»ºç«‹è¿æ¥çš„æ—¶é—´, å¦‚æœç”¨åˆ°åŠ å¯†åè®®è¿˜åŒ…æ‹¬æ¡æ‰‹æ—¶é—´</td></tr><tr><td style="text-align:left;"><code>$upstream_header_time</code></td><td style="text-align:left;">ä»åç«¯æœåŠ¡å™¨æ¥æ”¶å“åº”å¤´çš„æ—¶é—´, åŒ…æ‹¬å’Œåç«¯æœåŠ¡å™¨å»ºç«‹è¿æ¥çš„æ—¶é—´, åˆ°æ¥æ”¶å®Œå“åº”å¤´çš„æ—¶é—´</td></tr><tr><td style="text-align:left;"><code>$upstream_response_length</code></td><td style="text-align:left;">ä»åç«¯æœåŠ¡å™¨æ¥æ”¶å“åº”çš„é•¿åº¦</td></tr><tr><td style="text-align:left;"><code>$upstream_response_time</code></td><td style="text-align:left;">ä»åç«¯æœåŠ¡å™¨æ¥æ”¶å“åº”çš„æ—¶é—´, åŒ…æ‹¬å’Œåç«¯æœåŠ¡å™¨å»ºç«‹è¿æ¥çš„æ—¶é—´, æ¥æ”¶åˆ°å“åº”å¤´çš„æ—¶é—´, å’Œæ¥æ”¶å®Œå“åº”ä½“çš„æ—¶é—´</td></tr><tr><td style="text-align:left;"><code>$upstream_status</code></td><td style="text-align:left;">ä»åç«¯æœåŠ¡å™¨æ¥æ”¶çš„çŠ¶æ€ç </td></tr><tr><td style="text-align:left;"><code>$upstream_http_</code></td><td style="text-align:left;">ä»åç«¯æœåŠ¡å™¨æ¥æ”¶å“åº”å¤´çš„å€¼, ä¾‹å¦‚<code>upstream_http_content_type</code></td></tr></tbody></table><h2 id="main" tabindex="-1">main <a class="header-anchor" href="#main" aria-label="Permalink to &quot;main&quot;">â€‹</a></h2><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># æŒ‡å®šè¿è¡ŒnginxæœåŠ¡çš„ç”¨æˆ·å’Œç»„, </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># syntax:	user user [group];</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># default:	user nobody nobody;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># context:	main</span></span>
<span class="line"><span style="color:#FFCB6B;">user</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">nginx</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">nginx</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># æŒ‡å®šå·¥ä½œè¿›ç¨‹æ•°, å¯ä»¥æŒ‡å®šå…·ä½“çš„è¿›ç¨‹æ•°, ä¹Ÿå¯ä»¥autoè‡ªåŠ¨è®¾ç½®</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># syntax:	worker_processes number | auto;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># default:	worker_processes 1;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># context:	main</span></span>
<span class="line"><span style="color:#FFCB6B;">worker_processes</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">4</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># æŒ‡å®šå•ä¸ªè¿›ç¨‹æœ€å¤§èƒ½å¤Ÿæ‰“å¼€çš„æ–‡ä»¶æ•°é‡, å³æ–‡ä»¶æè¿°ç¬¦æ•°</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># syntax:	worker_rlimit_nofile number;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># default:	é»˜è®¤å€¼ä¸å½“å‰linuxç³»ç»Ÿä¸­è¿›ç¨‹å¯ä»¥æ‰“å¼€çš„æœ€å¤§æ–‡ä»¶æ•°é‡ç›¸åŒ</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># context:	main</span></span>
<span class="line"><span style="color:#FFCB6B;">worker_rlimit_nofile</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">65536</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># æŒ‡å®špidæ–‡ä»¶ä½ç½®, è¯¥æŒ‡ä»¤åªèƒ½åœ¨å…¨å±€å—é…ç½®</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># syntax:	pid file;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># default:	pid logs/nginx.pid;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># context:	main</span></span>
<span class="line"><span style="color:#FFCB6B;">pid</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/var/run/nginx.pid</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># ç”¨æ¥åŒ…å«å…¶ä»–çš„é…ç½®æ–‡ä»¶, æ­¤å¤„ç”¨æ¥æŒ‡å®šåª’ä½“ç±»å‹é…ç½®æ–‡ä»¶</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># syntax:   include file;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># context:  main, http, mail, stream, server, location</span></span>
<span class="line"><span style="color:#FFCB6B;">include</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">mime.types</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># å¯¹äºæ— æ‰©å±•åçš„æ–‡ä»¶, é»˜è®¤å…¶ä¸ºapplication/octet-streamç±»å‹, å³nginxä¼šå°†å…¶ä½œä¸ºä¸€ä¸ªå…«è¿›åˆ¶æµæ–‡ä»¶æ¥å¤„ç†</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># module:   ngx_http_core_module</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># syntax:	default_type mime-type;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># default:	default_type text/plain;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># context:	http, server, location</span></span>
<span class="line"><span style="color:#FFCB6B;">default_type</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">application/octet-stream</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># æ˜¯å¦å¼€å¯linuxç³»ç»Ÿçš„é›¶æ‹·è´æœºåˆ¶, å½“ç„¶è¿˜éœ€è¦å½“å‰æ“ä½œç³»ç»Ÿæ”¯æŒ</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># module:   ngx_http_core_module</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># syntax:	sendfile on | off;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># default:	sendfile off;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># context:	http, server, location</span></span>
<span class="line"><span style="color:#FFCB6B;">sendfile</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># å½“å¼€å¯è¯¥æŒ‡ä»¤æ˜¯ä¼šè°ƒç”¨æ“ä½œç³»ç»Ÿçš„tcp_corkæ–¹æ³•, å³åœ¨ä¸€å®šçš„æ—¶é—´æ®µ(é€šå¸¸ä¸º200ms), å°†å°æ•°æ®åŒ…æš‚å­˜, å¹¶å°†è¿™äº›å°æ•°æ®åŒ…æ•´åˆä¸ºä¸€ä¸ªå¤§çš„æ•°æ®åŒ…åå‘é€å‡ºå», å¯ä»¥ä¸€å®šç¨‹åº¦çš„æ”¹å–„ç½‘ç»œä¼ è¾“æ•ˆç‡</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># å½“å¼€å¯sendfileæŒ‡ä»¤æ—¶tcp_nopushæ‰ä¼šç”Ÿæ•ˆ, ä¸”å’Œtcp_nodelayæŒ‡ä»¤äº’æ–¥</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># module:   ngx_http_core_module</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># syntax:	tcp_nopush on | off;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># default:	tcp_nopush off;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># context:	http, server, location</span></span>
<span class="line"><span style="color:#FFCB6B;">tcp_nopush</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">off</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># å¼€å¯åä¼šç¦ç”¨tcp_nopushæŒ‡ä»¤, ä¸”åœ¨nginxå¼€å¯é•¿è¿æ¥æ‰ä¼šç”Ÿæ•ˆ, å³æ”¶åˆ°æ•°æ®åŒ…åå°½å¿«å‘é€å‡ºå»</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># module:   ngx_http_core_module</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># syntax:	tcp_nodelay on | off;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># default:	tcp_nodelay on;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># context:	http, server, location</span></span>
<span class="line"><span style="color:#FFCB6B;">tcp_nodelay</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">off</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><h2 id="events" tabindex="-1">events <a class="header-anchor" href="#events" aria-label="Permalink to &quot;events&quot;">â€‹</a></h2><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">events</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># å¯¹nginxå·¥ä½œè¿›ç¨‹æ¥æ”¶è¿æ¥åºåˆ—åŒ–, é˜²æ­¢å¤šä¸ªå·¥ä½œè¿›ç¨‹å¯¹è¿æ¥è¿›è¡Œäº‰æŠ¢(å½“å®¢æˆ·ç«¯å‘æ¥ä¸€ä¸ªè¯·æ±‚æ—¶, ä¼šæœ‰å¤šä¸ªnginxå·¥ä½œè¿›ç¨‹è¢«åŒæ—¶å”¤é†’, å³ä½¿æœ€ç»ˆåªæœ‰ä¸€ä¸ªå·¥ä½œè¿›ç¨‹ä¼šè·å¾—è¿æ¥, ä¸”å…¶ä»–å·¥ä½œè¿›ç¨‹ä¼šè¿›å…¥é˜»å¡çŠ¶æ€, å¦‚æœæ¯æ¬¡å”¤é†’çš„å·¥ä½œè¿›ç¨‹è¿‡å¤š, å°±ä¼šå½±å“nginxçš„æ•´ä½“æ€§èƒ½)</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># syntax:	accept_mutex on | off;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># default:	accept_mutex off;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># context:	events</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">accept_mutex</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># è®¾ç½®å•ä¸ªnginxå·¥ä½œè¿›ç¨‹æ˜¯å¦å…è®¸åŒæ—¶æ¥æ”¶å¤šä¸ªç½‘ç»œè¿æ¥</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># syntax:	multi_accept on | off;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># default:	multi_accept off;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># context:	events</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">multi_accept</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># è®¾ç½®I/Oäº‹ä»¶é©±åŠ¨æ¨¡å‹</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># syntax:   use  [method];</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;">## method:  [select | poll | kqueue | epoll | resig | /dev/poll | eventport]</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># default:  é€‰æ‹©å½“å‰æ“ä½œç³»ç»Ÿæ”¯æŒçš„äº‹ä»¶é©±åŠ¨æ¨¡å‹</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># context:  events</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">use</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">epoll</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># è®¾ç½®å•ä¸ªnginxå·¥ä½œè¿›ç¨‹å¯ä»¥åŒæ—¶å¼€å¯çš„æœ€å¤§è¿æ¥æ•°, å½“è¶…è¿‡è¿™ä¸ªå€¼æ—¶å°†ä¸åœ¨æ¥æ”¶è¿æ¥</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># syntax: worker_connections number;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># default: worker_connections 512;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># context: events</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">worker_connections</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1024</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h2 id="httpä¸ƒå±‚ä»£ç†" tabindex="-1">httpä¸ƒå±‚ä»£ç† <a class="header-anchor" href="#httpä¸ƒå±‚ä»£ç†" aria-label="Permalink to &quot;httpä¸ƒå±‚ä»£ç†&quot;">â€‹</a></h2><h3 id="upstream" tabindex="-1">upstream <a class="header-anchor" href="#upstream" aria-label="Permalink to &quot;upstream&quot;">â€‹</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># ç”¨äºå®šä¹‰å¯ä»¥ç”±proxy_passæŒ‡ä»¤å¼•ç”¨çš„æœåŠ¡å™¨ç»„, å¯ä»¥æŒ‡å®šæœåŠ¡èŠ‚ç‚¹çš„åœ°å€å’Œç›¸å…³çš„å‚æ•°, æœåŠ¡å™¨åœ°å€å¯ä»¥æ˜¯å¸¦ç«¯å£çš„åŸŸåæˆ–è€…ipåœ°å€ã€unixå¥—æ¥å­—è·¯å¾„, å‚æ•°å¯ä»¥è®¾ç½®æœåŠ¡æƒé‡ã€å¥åº·æ£€æŸ¥ç­‰</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># module: ngx_http_upstream_module</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># syntax:	server address [parameters];</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># default:	â€”</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># context:	http</span></span>
<span class="line"><span style="color:#FFCB6B;">upstream</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">backend</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">server</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.10.100:8080</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">server</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">ep01.example.com:8081</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">server</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">unix:/opt/app/uwsgi.sock</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># è®¾ç½®æœåŠ¡èŠ‚ç‚¹çš„æƒé‡</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># syntax:	server address weight=number;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">server</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.10.101:8080</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">weight=</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># è®¾ç½®åŒæ—¶è¿æ¥åˆ°è¯¥æœåŠ¡èŠ‚ç‚¹çš„æœ€å¤§è¿æ¥æ•°, é™åˆ¶æµé‡</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># syntax:	server address max_conns=number;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">server</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.10.102:8080</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">max_conns=</span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># åœ¨fail_timeoutæ—¶é—´å†…ä¸æœåŠ¡å°è¯•é€šä¿¡å¤±è´¥max_failsæ¬¡, åˆ™è§†ä¸ºæœåŠ¡ä¸å¯ç”¨ä¸”æµé‡ä¸ä¼šè½¬å‘åˆ°è¯¥æœåŠ¡èŠ‚ç‚¹ä¸Š;å¦‚æœåªæœ‰ä¸€ä¸ªæœåŠ¡èŠ‚ç‚¹å°†å¿½ç•¥è¯¥å‚æ•°</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># syntax:	server address max_fails=number fail_timeout=time; </span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">server</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.10.103:8080</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">max_fails=</span><span style="color:#F78C6C;">3</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">fail_timeout=</span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># æ ‡è®°å½“å‰æœåŠ¡èŠ‚ç‚¹ä¸ºå¤‡ç”¨èŠ‚ç‚¹, å½“ä¸»æœåŠ¡èŠ‚ç‚¹ä¸å¯ç”¨æ—¶, è¯¥èŠ‚ç‚¹æ‰ä¼šæ¥æ”¶è¿æ¥å¤„ç†è¯·æ±‚æ³¨æ„è¯¥å‚æ•°ä¸èƒ½ä¸hashå’Œrandomä¸€èµ·ä½¿ç”¨</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># syntax:	server address backup;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">server</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.10.104:8080</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">backup</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># ç”¨äºæ ‡è®°èŠ‚ç‚¹ä¸ºä¸å¯ç”¨</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># syntax:	server address down;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">server</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.10.101:8080</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">down</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># è®¾ç½®æœåŠ¡èŠ‚ç‚¹ä»æƒé‡ä»0æ¢å¤åˆ°æ­£å¸¸å€¼çš„æ—¶é—´; æ³¨æ„è¯¥å‚æ•°ä¸èƒ½ç”¨åœ¨åªæœ‰ä¸€ä¸ªæœåŠ¡èŠ‚ç‚¹æˆ–è€…ä½¿ç”¨hashã€randomè´Ÿè½½æ¨¡å¼ä¸‹</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># syntax:	server address slow_start=time;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">server</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.10.101:8080</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">weight=</span><span style="color:#F78C6C;">4</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">slow_start=</span><span style="color:#F78C6C;">60</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><h3 id="server" tabindex="-1">server <a class="header-anchor" href="#server" aria-label="Permalink to &quot;server&quot;">â€‹</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># ç”¨æ¥é…ç½®è™šæ‹Ÿä¸»æœº, å³æ¯ä¸€ä¸ªserverå—å°±æ˜¯ä¸€ä¸ªè™šæ‹Ÿä¸»æœº</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># module: ngx_http_core_module</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># syntax:	server { ... }</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># default:	â€”</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># context:	http</span></span>
<span class="line"><span style="color:#FFCB6B;">server</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># è®¾ç½®nginxæœåŠ¡å™¨ç›‘å¬çš„åœ°å€å’Œç«¯å£</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># æ²¡æœ‰æ˜¾ç¤ºçš„ç”³æ˜default_serveræ˜¯, nginxä¼šå°†é…ç½®çš„ç¬¬ä¸€ä¸ªserverä½œä¸ºdefault_server</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># å½“è¯·æ±‚æ²¡æœ‰åŒ¹é…åˆ°ä»»ä½•server_nameæ—¶,default_serverä¼šå¤„ç†è¯¥è¯·æ±‚</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># syntax:	listen port [default_server] [ssl] [http2 | quic];</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># default:	listen *:80 | *:8000;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># context:	server</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">listen</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">80</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">default_server</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">listen</span><span style="color:#BABED8;"> [::]:80</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># ä¸ºè™šæ‹Ÿä¸»æœºè®¾ç½®åç§°, å¯ä»¥é…ç½®å¤šä¸ªserver_name, å¯ä»¥ä½¿ç”¨é€šé…ç¬¦, æ­£åˆ™è¡¨è¾¾å¼ç­‰</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># åŒ¹é…è§„åˆ™: ä¾æ¬¡æŒ‰ç…§ç²¾ç¡®åŒ¹é…ã€ä»¥*é€šé…ç¬¦å¼€å§‹çš„æœ€é•¿å­—ç¬¦ä¸²åŒ¹é…ã€ä»¥*é€šé…ç¬¦ç»“æŸçš„æœ€é•¿å­—ç¬¦ä¸²åŒ¹é…ã€ç¬¬ä¸€ä¸ªåŒ¹é…çš„æ­£åˆ™è¡¨è¾¾å¼</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># syntax:	server_name name ...;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># default:	server_name &quot;&quot;;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># context:	server</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">server_name</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">www.example.com</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">bbs.example.com</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">.example.com</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">server_name</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;">*</span><span style="color:#C3E88D;">.example.com</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">server_name</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">www.example.</span><span style="color:#BABED8;">*</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">server_name</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">www</span><span style="color:#BABED8;">\\d</span><span style="color:#C3E88D;">+</span><span style="color:#BABED8;">\\.</span><span style="color:#C3E88D;">example</span><span style="color:#BABED8;">\\.</span><span style="color:#C3E88D;">com</span><span style="color:#BABED8;">$</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">server_name</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">_</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># æ˜¯å¦å¼€å¯åœ¨å“åº”å¤´ä¸­æ˜¾ç¤ºnginxæœåŠ¡å™¨ç‰ˆæœ¬</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># syntax:	server_tokens on | off | build;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># default:	server_tokens on;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># context:	http, server, location</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">server_tokens</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">off</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># æ·»åŠ å“åº”å¤´</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># module:   ngx_http_headers_module</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># syntax:	add_header name value [always];</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># default:	â€”</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># context:	http, server, location</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># æ·»åŠ å“åº”å¤´è§£å†³è·¨åŸŸé—®é¢˜</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">add_header</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Access-Control-Allow-Origin</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> $http_origin</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">add_header</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Access-Control-Allow-Credentials</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">true</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">add_header</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Access-Control-Allow-Methods</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">GET, POST, OPTIONS</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">add_header</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Access-Control-Allow-Headers</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">DNT,Authorization,Accept,Origin,Keep-Alive,User-Agent,X-Mx-ReqToken,X-Data-Type,X-Auth-Token,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">add_header</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Access-Control-Expose-Headers</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Content-Length,Content-Range</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># è®¾ç½®è¢«åµŒå…¥(iframe)è§„åˆ™</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># DENY è¯¥é¡µé¢ä¸å…è®¸åœ¨frameä¸­å±•ç¤º</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># SAMEORIGIN è¯¥é¡µé¢å¯ä»¥åœ¨ç›¸åŒåŸŸåé¡µé¢çš„frameä¸­å±•ç¤º</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># ALLOW-FROM uri è¡¨ç¤ºè¯¥é¡µé¢å¯ä»¥åœ¨æŒ‡å®šæ¥æºçš„frameä¸­å±•ç¤º</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">add_header</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">X-Frame-Options</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">SAMEORIGIN</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># è®¾ç½®ç”¨äºè¯»å–å®¢æˆ·ç«¯è¯·æ±‚ä½“çš„ç¼“å†²å™¨å¤§å°, å¦‚æœè¯·æ±‚ä½“å¤§äºç¼“å†²åŒºå¤§å°, åˆ™ä¼šå†™å…¥ä¸´æ—¶æ–‡ä»¶ä¸­</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># syntax:	client_body_buffer_size size;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># default:	client_body_buffer_size 8k|16k;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># context:	http, server, location</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">client_body_buffer_size</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1024</span><span style="color:#C3E88D;">k</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># è®¾ç½®ç”¨äºå­˜å‚¨å®¢æˆ·ç«¯è¯·æ±‚ä½“çš„å†å²æ–‡ä»¶, åœ¨æŒ‡å®šçš„ç›®å½•ä¸‹æœ€å¤šå¯ä»¥ä½¿ç”¨ä¸‰æç›®å½•ç»“æ„</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># syntax:	client_body_temp_path path [level1 [level2 [level3]]];</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># default:	client_body_temp_path client_body_temp;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># context:	http, server, location</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">client_body_temp_path</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/opt/nginx/client_body_temp</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># è®¾ç½®å®¢æˆ·ç«¯è¯·æ±‚ä½“çš„æœ€å¤§å¤§å°, è¶…è¿‡è¿™ä¸ªå¤§å°åˆ™è¿”å›413 Request Entity Too Large</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># syntax:	client_max_body_size size;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># default:	client_max_body_size 1m;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># context:	http, server, location</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">client_max_body_size</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">10</span><span style="color:#C3E88D;">m</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># è®¾ç½®ç”¨äºè¯»å–å®¢æˆ·ç«¯è¯·æ±‚å¤´çš„ç¼“å†²å™¨å¤§å°, å¦‚æœè¯·æ±‚å¤´è¿‡é•¿, åˆ™åˆ†é…large_client_header_buffers</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># syntax:	client_header_buffer_size size;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># default:	client_header_buffer_size 1k;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># context:	http, server</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">client_header_buffer_size</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">4</span><span style="color:#C3E88D;">k</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># è®¾ç½®ç”¨äºè¯»å–å¤§å‹å®¢æˆ·ç«¯è¯·æ±‚å¤´çš„ç¼“å†²åŒºæ•°é‡å’Œå¤§å°</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># syntax:	large_client_header_buffers number size;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># default:	large_client_header_buffers 4 8k;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># context:	http, server</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">large_client_header_buffers</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">4</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">32</span><span style="color:#C3E88D;">k</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># è®¾ç½®è¯»å–å®¢æˆ·ç«¯è¯·æ±‚å¤´çš„è¶…æ—¶æ—¶é—´, è¶…æ—¶åˆ™è¿”å›408 Request Timed Out</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># syntax:	client_header_timeout time;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># default:	client_header_timeout 60s;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># context:	http, server</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">client_header_timeout</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">20</span><span style="color:#C3E88D;">s</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># è®¾ç½®keepalivecè¶…æ—¶æ—¶é—´, åœ¨ä¸€ä¸ªæ´»è·ƒè¿æ¥è¶…è¿‡è¯¥æ—¶é—´å, æœåŠ¡å™¨å’Œæµè§ˆå™¨éƒ½ä¼šå»å…³é—­è¿™ä¸ªè¿æ¥, å½“ç„¶è¯¥å‚æ•°æ˜¯çº¦æŸnginxæœåŠ¡å™¨çš„, nginxä¹Ÿä¼šæŒ‰ç…§è§„èŒƒæŠŠè¿™ä¸ªæ—¶é—´ä¼ ç»™æµè§ˆå™¨, ä½†æ¯ä¸ªæµè§ˆå™¨å¯¹å¾…keepaliveçš„ç­–ç•¥æœ‰å¯èƒ½æ˜¯ä¸åŒçš„</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># syntax:	keepalive_timeout timeout [header_timeout];</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># default:	keepalive_timeout 75s;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># context:	http, server, location</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">keepalive_timeout</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">60</span><span style="color:#C3E88D;">s</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># è®¾ç½®ä½¿ç”¨proxy_hide_headerå’Œproxy_set_headeræŒ‡ä»¤æ—¶ä½¿ç”¨çš„æœ€å¤§hashè¡¨å¤§å°</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># syntax:	proxy_headers_hash_max_size size;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># default:	proxy_headers_hash_max_size 512;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># context:	http, server, location</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">proxy_headers_hash_max_size</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">512</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># è®¾ç½®ä½¿ç”¨proxy_hide_headerå’Œproxy_set_headeræŒ‡ä»¤æ—¶ä½¿ç”¨çš„hashè¡¨å­˜å‚¨æ¡¶çš„å¤§å°</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># syntax:	proxy_headers_hash_bucket_size size;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># default:	proxy_headers_hash_bucket_size 64;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># context:	http, server, location</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">proxy_headers_hash_bucket_size</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">64</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># å’Œåç«¯ä»£ç†æœåŠ¡å™¨å»ºç«‹è¿æ¥çš„è¶…æ—¶æ—¶é—´</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># syntax:	proxy_connect_timeout time;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># default:	proxy_connect_timeout 60s;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># context:	http, server, location</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">proxy_connect_timeout</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">20</span><span style="color:#C3E88D;">s</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># è®¾ç½®æ ¹æ®uriåŒ¹é…å¹¶ä¸”å®šä½åˆ°å¯¹åº”çš„å¤„ç†è¯¥è¯·æ±‚çš„é…ç½®</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># syntax:	location [ = | ~ | ~* | ^~ ] uri { ... }</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># default:	â€”</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># context:	server</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">location</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#676E95;font-style:italic;"># ä¿®æ”¹æˆ–è¿½åŠ ä¼ é€’ç»™åç«¯æœåŠ¡èŠ‚ç‚¹çš„è¯·æ±‚å¤´</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#676E95;font-style:italic;"># syntax:	proxy_set_header field value;</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#676E95;font-style:italic;"># default:	proxy_set_header Host $proxy_host;</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#676E95;font-style:italic;">#           proxy_set_header Connection close;</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#676E95;font-style:italic;"># context:	http, server, location</span></span>
<span class="line"><span style="color:#BABED8;">        </span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#676E95;font-style:italic;"># example01: è®¾ç½®è¯·æ±‚å¤´host</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#FFCB6B;">proxy_set_header</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">Host</span><span style="color:#BABED8;"> $host</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#676E95;font-style:italic;"># example02: è®¾ç½®è¯·æ±‚å¤´X-Real-IPä¸º$remote_addr</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#676E95;font-style:italic;"># $remote_addræ˜¯æŒ‡è®¿é—®nginxæœåŠ¡å™¨çš„å®¢æˆ·ç«¯, å¹¶éæœ€åˆçš„å®¢æˆ·ç«¯ipåœ°å€</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#FFCB6B;">proxy_set_header</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">X-Real-IP</span><span style="color:#BABED8;"> $remote_addr</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#676E95;font-style:italic;"># example03: è®¾ç½®è¯·æ±‚å¤´X-Forwarded-For $proxy_add_x_forwarded_for</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#676E95;font-style:italic;"># $proxy_add_x_forwarded_forä»£è¡¨é™„åŠ $remote_addrå˜é‡çš„å®¢æˆ·ç«¯è¯·æ±‚å¤´X-Forwarded-For, å¯ä»¥ç†è§£ä¸º$proxy_add_x_forwarded_forä¼šä¾æ¬¡è®°å½•$remote_addrå€¼å¹¶ä»¥é€—å·åˆ†éš”, ç¬¬ä¸€ä¸ªå€¼å°±æ˜¯å®¢æˆ·ç«¯ip</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#676E95;font-style:italic;"># å¦‚æœX-Forwarded-Forå­—æ®µæ²¡å‡ºç°åœ¨å®¢æˆ·ç«¯è¯·æ±‚å¤´ä¸­, $proxy_add_x_forwarded_forç­‰åŒäº$remote_addr</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#FFCB6B;">proxy_set_header</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">X-Forwarded-For</span><span style="color:#BABED8;"> $proxy_add_x_forwarded_for</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">        </span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#676E95;font-style:italic;"># è®¾ç½®ä»£ç†æœåŠ¡å™¨åœ°å€ç«¯å£å’Œåè®®, åè®®å¯ä»¥æ˜¯httpæˆ–è€…https, åœ°å€å¯ä»¥ä½¿ipåŸŸåæˆ–è€…upstreamä¸­é…ç½®çš„æœåŠ¡å™¨ç»„</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#676E95;font-style:italic;"># syntax:	proxy_pass URL;</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#676E95;font-style:italic;"># default:	â€”</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#676E95;font-style:italic;"># context:	location</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#FFCB6B;">proxy_pass</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">http://www.example.com</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br></div></div><h3 id="locationåŒ¹é…è§„åˆ™" tabindex="-1">locationåŒ¹é…è§„åˆ™ <a class="header-anchor" href="#locationåŒ¹é…è§„åˆ™" aria-label="Permalink to &quot;locationåŒ¹é…è§„åˆ™&quot;">â€‹</a></h3><table><thead><tr><th style="text-align:left;">è¡¨è¾¾å¼</th><th style="text-align:left;">æ¨¡å¼</th><th style="text-align:left;">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:left;">=</td><td style="text-align:left;">ç²¾ç¡®åŒ¹é…</td><td style="text-align:left;">åŒ¹é…æˆåŠŸ,åˆ™ç»ˆæ­¢å…¶ä»–locationçš„åŒ¹é…é¡¹,ä¼˜å…ˆçº§æœ€é«˜</td></tr><tr><td style="text-align:left;">^~</td><td style="text-align:left;">å‰ç¼€åŒ¹é…</td><td style="text-align:left;">å’Œé¡ºåºæ— å…³,æŒ‰ç…§å‘½ä¸­é•¿çŸ­æ¥ç¡®å®š</td></tr><tr><td style="text-align:left;">~</td><td style="text-align:left;">æ­£åˆ™åŒ¹é…,åŒºåˆ†å¤§å°å†™</td><td style="text-align:left;">å’Œé¡ºåºæœ‰å…³ç³»,åŒ¹é…åˆ°äº†å°±åœæ­¢</td></tr><tr><td style="text-align:left;">~*</td><td style="text-align:left;">æ­£åˆ™åŒ¹é…,ä¸åŒºåˆ†å¤§å°å†™</td><td style="text-align:left;">å’Œé¡ºåºæœ‰å…³ç³»,åŒ¹é…åˆ°äº†å°±åœæ­¢</td></tr><tr><td style="text-align:left;">/</td><td style="text-align:left;">æ™®é€šåŒ¹é…</td><td style="text-align:left;">å’Œé¡ºåºæ— å…³,æŒ‰ç…§å‘½ä¸­é•¿çŸ­æ¥ç¡®å®š,ä¼˜å…ˆçº§æœ€ä½</td></tr></tbody></table><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># syntax:	location [ = | ~ | ~* | ^~ ] uri { ... }</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># default:	â€”</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># context:	server</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="ç²¾ç¡®åŒ¹é…" tabindex="-1">ç²¾ç¡®åŒ¹é… <a class="header-anchor" href="#ç²¾ç¡®åŒ¹é…" aria-label="Permalink to &quot;ç²¾ç¡®åŒ¹é…&quot;">â€‹</a></h4><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># uriå¿…é¡»å®Œå…¨ä¸€è‡´æ‰èƒ½åŒ¹é…åˆ°</span></span>
<span class="line"><span style="color:#FFCB6B;">location</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">=</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/abc</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{}</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># å¯ä»¥åŒ¹é…åˆ°</span></span>
<span class="line"><span style="color:#FFCB6B;">http://localhost/abc</span></span>
<span class="line"><span style="color:#FFCB6B;">http://localhost/abc?key</span><span style="color:#BABED8;">=1</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># ä¸èƒ½åŒ¹é…åˆ°</span></span>
<span class="line"><span style="color:#FFCB6B;">http://localhost/abc/</span></span>
<span class="line"><span style="color:#FFCB6B;">http://localhost/abcd</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="å‰ç¼€åŒ¹é…" tabindex="-1">å‰ç¼€åŒ¹é… <a class="header-anchor" href="#å‰ç¼€åŒ¹é…" aria-label="Permalink to &quot;å‰ç¼€åŒ¹é…&quot;">â€‹</a></h4><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># uriå¿…é¡»ä»¥æŒ‡å®šçš„å‰ç¼€å¼€å¤´æ‰èƒ½åŒ¹é…åˆ°</span></span>
<span class="line"><span style="color:#FFCB6B;">location</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">^~</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/static/</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{}</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># åªæœ‰uriä»¥/static/å¼€å¤´æ‰èƒ½åŒ¹é…åˆ°</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="æ­£åˆ™åŒ¹é…" tabindex="-1">æ­£åˆ™åŒ¹é… <a class="header-anchor" href="#æ­£åˆ™åŒ¹é…" aria-label="Permalink to &quot;æ­£åˆ™åŒ¹é…&quot;">â€‹</a></h4><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># uriéœ€è¦ç¬¦åˆæ­£åˆ™è¡¨è¾¾å¼æ‰èƒ½åŒ¹é…åˆ°</span></span>
<span class="line"><span style="color:#FFCB6B;">location</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">=</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">~</span><span style="color:#BABED8;">*</span><span style="color:#BABED8;"> \\.</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">jpg</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">png</span><span style="color:#89DDFF;">|</span><span style="color:#FFCB6B;">gif</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;">$  </span><span style="color:#C3E88D;">{}</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># uriä¸­ä»¥.jpg .png .gifç»“å°¾çš„æ‰èƒ½åŒ¹é…åˆ°</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="é€šç”¨åŒ¹é…" tabindex="-1">é€šç”¨åŒ¹é… <a class="header-anchor" href="#é€šç”¨åŒ¹é…" aria-label="Permalink to &quot;é€šç”¨åŒ¹é…&quot;">â€‹</a></h4><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># ä»»ä½•uriéƒ½èƒ½åŒ¹é…åˆ°, ä½†æ˜¯ä¼˜å…ˆçº§æœ€ä½</span></span>
<span class="line"><span style="color:#FFCB6B;">location</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="proxy-passåŒ¹é…è§„åˆ™" tabindex="-1">proxy_passåŒ¹é…è§„åˆ™ <a class="header-anchor" href="#proxy-passåŒ¹é…è§„åˆ™" aria-label="Permalink to &quot;proxy_passåŒ¹é…è§„åˆ™&quot;">â€‹</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">location</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/apis/v1</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># å¦‚æœproxy_passåé¢æ²¡æœ‰æºå¸¦uri, åˆ™å®¢æˆ·ç«¯è¯·æ±‚uriä¼šå®Œæ•´çš„ä¼ é€’åˆ°åç«¯æœåŠ¡å™¨; ä¾‹å¦‚å®¢æˆ·ç«¯çš„uri: /apis/v1/user, ä¼ é€’ç»™åç«¯èŠ‚ç‚¹çš„uri: /apis/v1/user</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">proxy_pass</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">http://192.168.10.100:8080</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">location</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/apis/v1</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># å¦‚æœproxy_passåé¢æºå¸¦äº†uri, åˆ™å®¢æˆ·ç«¯çš„è¯·æ±‚uriåˆ™ä¼šå°†åŒ¹é…åˆ°çš„éƒ¨åˆ†æ›¿æ¢ä¸ºproxy_passæŒ‡ä»¤ä¸­é…ç½®çš„uri; ä¾‹å¦‚å®¢æˆ·ç«¯çš„uri: /apis/v1/user, ä¼ é€’ç»™åç«¯èŠ‚ç‚¹çš„uri: /api/v2/user</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">proxy_pass</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">http://192.168.10.100:8080/api/v2</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="gzipå‹ç¼©" tabindex="-1">gzipå‹ç¼© <a class="header-anchor" href="#gzipå‹ç¼©" aria-label="Permalink to &quot;gzipå‹ç¼©&quot;">â€‹</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># æ˜¯å¦å¼€å¯gzipå‹ç¼©æŒ‡ä»¤</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># module:   ngx_http_gzip_module</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># syntax:	gzip on | off;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># default:	gzip off;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># context:	http, server, location</span></span>
<span class="line"><span style="color:#FFCB6B;">gzip</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># è®¾ç½®éœ€è¦è¿›è¡Œgzipå‹ç¼©çš„æ–‡ä»¶ç±»å‹</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># module:   ngx_http_gzip_module</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># syntax:	gzip_types mime-type ...;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># default:	gzip_types text/html;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># context:	http, server, location</span></span>
<span class="line"><span style="color:#FFCB6B;">gzip_types</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">text/plain</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">text/css</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">application/javascript</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># è®¾ç½®å‹ç¼©ç­‰çº§, èŒƒå›´ä¸º1åˆ°9, æ•°å­—è¶Šå¤§å‹ç¼©ç‡è¶Šé«˜, ä½†åŒæ—¶ä¹Ÿä¼šå¢åŠ å‹ç¼©çš„æ—¶é—´</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># syntax:	gzip_comp_level level;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># default:	gzip_comp_level 1;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># context:	http, server, location</span></span>
<span class="line"><span style="color:#FFCB6B;">gzip_comp_level</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># è®¾ç½®è¿›è¡Œgzipå‹ç¼©çš„æœ€å°æ–‡ä»¶å¤§å°, åªæœ‰å½“æ–‡ä»¶å¤§å°è¶…è¿‡è¯¥å€¼æ—¶, æ‰ä¼šè¿›è¡Œgzipå‹ç¼©</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># syntax:	gzip_min_length length;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># default:	gzip_min_length 20;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># context:	http, server, location</span></span>
<span class="line"><span style="color:#FFCB6B;">gzip_min_length</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">k</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># è®¾ç½®æœ€å°çš„éœ€è¦gzipå‹ç¼©å“åº”çš„httpåè®®ç‰ˆæœ¬å·</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># syntax:	gzip_http_version 1.0 | 1.1;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># default:	gzip_http_version 1.1;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># context:	http, server, location</span></span>
<span class="line"><span style="color:#FFCB6B;">gzip_http_version</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1.1</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h3 id="æ—¥å¿—é…ç½®" tabindex="-1">æ—¥å¿—é…ç½® <a class="header-anchor" href="#æ—¥å¿—é…ç½®" aria-label="Permalink to &quot;æ—¥å¿—é…ç½®&quot;">â€‹</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># è®¾ç½®é”™è¯¯æ—¥å¿—å­˜å‚¨ä½ç½®å’Œæ—¥å¿—ç­‰çº§</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># syntax:	error_log file [level: debug | info | notice | warn | error | crit | alert];</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># default:	error_log logs/error.log error;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># context:	main, http, mail, stream, server, location</span></span>
<span class="line"><span style="color:#FFCB6B;">error_log</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/var/log/nginx/error.log</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">notice</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># æ—¥å¿—æ ¼å¼, åŸºæœ¬åŒ…å«äº†æ‰€æœ‰çš„å­—æ®µ ,å¯ä»¥æ ¹æ®å®é™…æƒ…å†µè°ƒæ•´</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># syntax:	log_format name [escape=default|json|none] string ...;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># default:	log_format combined &quot;...&quot;;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># context:	http</span></span>
<span class="line"><span style="color:#FFCB6B;">log_format</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">main</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">$remote_addr - $remote_user [$time_local] &quot;$request&quot; </span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#BABED8;">                </span><span style="color:#FFCB6B;">&#39;$status $body_bytes_sent &quot;$http_referer&quot; &#39;</span></span>
<span class="line"><span style="color:#BABED8;">                </span><span style="color:#FFCB6B;">&#39;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot; &#39;</span></span>
<span class="line"><span style="color:#BABED8;">                </span><span style="color:#FFCB6B;">&#39;[$request_time $upstream_addr $upstream_connect_time $upstream_bytes_sent &#39;</span></span>
<span class="line"><span style="color:#BABED8;">                </span><span style="color:#FFCB6B;">&#39;$upstream_header_time $upstream_response_time $upstream_status $upstream_bytes_received $upstream_response_length $upstream_http_content_type]&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># è®¿é—®æ—¥å¿—</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Syntax:	access_log path [format [buffer=size] [gzip[=level]] [flush=time] [if=condition]];</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 			access_log off;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Default:	access_log logs/access.log combined;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Context:	http, server, location</span></span>
<span class="line"><span style="color:#FFCB6B;">access_log</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/var/log/nginx/access.log</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">main</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">buffer=</span><span style="color:#F78C6C;">32</span><span style="color:#C3E88D;">k</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="nginxæœåŠ¡çŠ¶æ€" tabindex="-1">nginxæœåŠ¡çŠ¶æ€ <a class="header-anchor" href="#nginxæœåŠ¡çŠ¶æ€" aria-label="Permalink to &quot;nginxæœåŠ¡çŠ¶æ€&quot;">â€‹</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># ä¸€èˆ¬ç”¨äºnginxè¿æ¥çš„çŠ¶æ€ç›‘æ§</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># module:   ngx_http_stub_status_module</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># syntax:	stub_status;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># default:	â€”</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># context:	server, location</span></span>
<span class="line"><span style="color:#FFCB6B;">location</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/ngx_status</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">stub_status</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><table><thead><tr><th style="text-align:left;">çŠ¶æ€</th><th style="text-align:left;">è¯´æ˜</th></tr></thead><tbody><tr><td style="text-align:left;"><code>Active connections</code></td><td style="text-align:left;">å½“å‰æ´»è·ƒçš„å®¢æˆ·ç«¯è¿æ¥æ•°, åŒ…æ‹¬ç­‰å¾…çš„è¿æ¥æ•°</td></tr><tr><td style="text-align:left;"><code>accepts</code></td><td style="text-align:left;">å·²æ¥æ”¶çš„å®¢æˆ·ç«¯è¯·æ±‚æ•°</td></tr><tr><td style="text-align:left;"><code>handled</code></td><td style="text-align:left;">å·²å¤„ç†çš„å®¢æˆ·ç«¯è¯·æ±‚æ•°</td></tr><tr><td style="text-align:left;"><code>requests</code></td><td style="text-align:left;">å®¢æˆ·ç«¯è¯·æ±‚æ•°</td></tr><tr><td style="text-align:left;"><code>Reading</code></td><td style="text-align:left;">æ­£åœ¨è¯»å–å®¢æˆ·ç«¯è¯·æ±‚å¤´çš„è¿æ¥æ•°</td></tr><tr><td style="text-align:left;"><code>Writing</code></td><td style="text-align:left;">æ­£åœ¨å›å†™å“åº”çš„å½“å‰è¿æ¥æ•°</td></tr><tr><td style="text-align:left;"><code>Waiting</code></td><td style="text-align:left;">å½“å‰ç©ºé—²çš„å®¢æˆ·ç«¯è¿æ¥æ•°</td></tr></tbody></table><h3 id="è®¿é—®æ§åˆ¶" tabindex="-1">è®¿é—®æ§åˆ¶ <a class="header-anchor" href="#è®¿é—®æ§åˆ¶" aria-label="Permalink to &quot;è®¿é—®æ§åˆ¶&quot;">â€‹</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># å…è®¸æŒ‡å®šçš„ç½‘ç»œåœ°å€è®¿é—®</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># module:   ngx_http_access_module</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># syntax:	allow address | CIDR | unix: | all;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># default:	â€”</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># context:	http, server, location</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># æ‹’ç»æŒ‡å®šçš„ç½‘ç»œåœ°å€è®¿é—®</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># module:   ngx_http_access_module</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># syntax:	deny address | CIDR | unix: | all;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># default:	â€”</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># context:	http, server, location, limit_except</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># åªå…è®¸localhostå’Œ172.17.0.0/16æ®µçš„åœ°å€è®¿é—®</span></span>
<span class="line"><span style="color:#FFCB6B;">location</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/ngx_status</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">stub_status</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">allow</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">127.0</span><span style="color:#C3E88D;">.0.1</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">allow</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">172.17</span><span style="color:#C3E88D;">.0.0/16</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">deny</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">all</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h3 id="é™æµ" tabindex="-1">é™æµ <a class="header-anchor" href="#é™æµ" aria-label="Permalink to &quot;é™æµ&quot;">â€‹</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># è®¾ç½®è¯¥limit_reqå…±äº«åŒºåŸŸå‚æ•°</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># module:   ngx_http_limit_req_module</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># syntax:	limit_req_zone key zone=name:size rate=rate [sync];</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># default:	â€”</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># context:	http</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">## key å®šä¹‰ç”¨äºé™åˆ¶é€Ÿç‡çš„ä¾æ®,æ­¤å¤„ä½¿ç”¨$binary_remote_addræ˜¯å› ä¸ºæ¯”$remote_addrå ç”¨æ›´å°çš„å†…å­˜ç©ºé—´</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">## zone å®šä¹‰å…±äº«åŒºåŸŸåç§°å’Œå¤§å°, 1må¤§çº¦èƒ½å­˜å‚¨8000ä¸ª$binary_remote_addr(64ä½)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">## rate æŒ‡å®šè¯·æ±‚é€Ÿç‡(r/s)æˆ–(r/m), è¯¥ç¤ºä¾‹ä¸­è¯·æ±‚é€Ÿç‡é™åˆ¶ä¸ºæ¯ç§’10ä¸ªè¯·æ±‚, å³æ¯100æ¯«ç§’1ä¸ª, è¶…è¿‡è¯¥é™åˆ¶é€Ÿç‡çš„è¯·æ±‚ä¼šè¿”å›503</span></span>
<span class="line"><span style="color:#FFCB6B;">limit_req_zone</span><span style="color:#BABED8;"> $binary_remote_addr </span><span style="color:#C3E88D;">zone=mylimit:10m</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">rate=</span><span style="color:#F78C6C;">10</span><span style="color:#C3E88D;">r/s</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># è®¾ç½®limit_reqçš„å…±äº«åŒºåŸŸåç§°å’Œçªå‘è¯·æ±‚å¤§å°</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># syntax:	limit_req zone=name [burst=number] [nodelay | delay=number];</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># default:	â€”</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># context:	http, server, location</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">## burst è¡¨ç¤ºå®¢æˆ·ç«¯å¯ä»¥è¶…è¿‡åŒºåŸŸæŒ‡å®šé€Ÿç‡çš„è¯·æ±‚æ•°</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">## nodelay è¡¨ç¤ºè¯¥è¯·æ±‚ä¼šåŠæ—¶å¤„ç†, ä¸ä¼šæ”¾åˆ°è¯·æ±‚é˜Ÿåˆ—ä¸­</span></span>
<span class="line"><span style="color:#FFCB6B;">server</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">location</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/apis</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#FFCB6B;">limit_req</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">zone=mylimit</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">burst=</span><span style="color:#F78C6C;">5</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">nodelay</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    }</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># è®¾ç½®limit_connå…±äº«åŒºåŸŸå‚æ•°</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># module:   ngx_http_limit_conn_module</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># syntax:	limit_conn_zone key zone=name:size;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># default:	â€”</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># context:	http</span></span>
<span class="line"><span style="color:#FFCB6B;">limit_conn_zone</span><span style="color:#BABED8;"> $binary_remote_addr </span><span style="color:#C3E88D;">zone=addr:10m</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># è®¾ç½®ç»™å®škeyçš„å…±äº«åŒºåŸŸå’Œå…è®¸çš„æœ€å¤§è¿æ¥æ•°</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># syntax:	limit_conn zone number;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># default:	â€”</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># context:	http, server, location</span></span>
<span class="line"><span style="color:#FFCB6B;">server</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">location</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/download/</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#FFCB6B;">limit_conn</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">addr</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    }</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h3 id="æ¨¡æ‹Ÿè·¨åŸŸ" tabindex="-1">æ¨¡æ‹Ÿè·¨åŸŸ <a class="header-anchor" href="#æ¨¡æ‹Ÿè·¨åŸŸ" aria-label="Permalink to &quot;æ¨¡æ‹Ÿè·¨åŸŸ&quot;">â€‹</a></h3><p>step01 å¿«é€Ÿå¯åŠ¨nginx</p><div class="language-yaml line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F07178;">version</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">3</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F07178;">services</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#F07178;">nginx</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">hostname</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">nginx</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">image</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">nginx:alpine</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">container_name</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">nginx</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">volumes</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">./conf:/etc/nginx</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">ports</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">10000:10000</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">9000:9000</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#89DDFF;">-</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">8000:8000</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">logging</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F07178;">driver</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">json-file</span></span>
<span class="line"><span style="color:#BABED8;">      </span><span style="color:#F07178;">options</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F07178;">max-size</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">100m</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#F07178;">max-file</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">3</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#F07178;">restart</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">on-failure</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>step02 <code>/etc/nginx/conf.d/default.conf</code></p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">server</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">listen</span><span style="color:#BABED8;">       </span><span style="color:#F78C6C;">10000</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">server_name</span><span style="color:#BABED8;">  </span><span style="color:#C3E88D;">localhost</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">location</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#FFCB6B;">root</span><span style="color:#BABED8;">   </span><span style="color:#C3E88D;">/etc/nginx/html</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#FFCB6B;">index</span><span style="color:#BABED8;">  </span><span style="color:#C3E88D;">index.html</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">index.htm</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    }</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">server</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">listen</span><span style="color:#BABED8;">       </span><span style="color:#F78C6C;">9000</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">server_name</span><span style="color:#BABED8;">  </span><span style="color:#C3E88D;">localhost</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">location</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#FFCB6B;">proxy_pass</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">http://localhost:8000</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    }</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">server</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">listen</span><span style="color:#BABED8;">       </span><span style="color:#F78C6C;">8000</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">server_name</span><span style="color:#BABED8;">  </span><span style="color:#C3E88D;">localhost</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">location</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#FFCB6B;">default_type</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">application/json</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">200</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">{&quot;code&quot;:&quot;0000&quot;,&quot;msg&quot;:&quot;success&quot;}</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    }</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>step03 <code>/etc/nginx/html/index.html</code></p><div class="language-html line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span><span style="color:#BABED8;">CORS</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">div</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#82AAFF;">fetch</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http://192.168.10.11:9000/</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">headers</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">accept</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">application/json</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">body</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">null,</span></span>
<span class="line"><span style="color:#BABED8;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">method</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">GET</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">then</span><span style="color:#BABED8;">(</span><span style="color:#BABED8;font-style:italic;">res</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">   </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">res: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">res</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">catch</span><span style="color:#BABED8;">(</span><span style="color:#BABED8;font-style:italic;">err</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">   </span><span style="color:#BABED8;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">err: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">err</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">script</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">html</span><span style="color:#89DDFF;">&gt;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>step04 æµè§ˆå™¨æµ‹è¯•è®¿é—®<code>http://192.168.10.11:10000</code></p><h3 id="å¤„ç†è·¨åŸŸ" tabindex="-1">å¤„ç†è·¨åŸŸ <a class="header-anchor" href="#å¤„ç†è·¨åŸŸ" aria-label="Permalink to &quot;å¤„ç†è·¨åŸŸ&quot;">â€‹</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#FFCB6B;">server</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">listen</span><span style="color:#BABED8;">       </span><span style="color:#F78C6C;">9000</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">server_name</span><span style="color:#BABED8;">  </span><span style="color:#C3E88D;">localhost</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">location</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#676E95;font-style:italic;"># add_header &#39;Access-Control-Allow-Origin&#39; &#39;*&#39; always;</span></span>
<span class="line highlighted"><span style="color:#BABED8;">        </span><span style="color:#FFCB6B;">add_header</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Access-Control-Allow-Origin</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> $http_origin </span><span style="color:#C3E88D;">always</span><span style="color:#89DDFF;">;</span></span>
<span class="line highlighted"><span style="color:#BABED8;">        </span><span style="color:#FFCB6B;">add_header</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Access-Control-Allow-Credentials</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">true</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line highlighted"><span style="color:#BABED8;">        </span><span style="color:#FFCB6B;">add_header</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Access-Control-Allow-Methods</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">GET, POST, OPTIONS</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line highlighted"><span style="color:#BABED8;">        </span><span style="color:#FFCB6B;">add_header</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Access-Control-Allow-Headers</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">DNT,Authorization,Accept,Origin,Keep-Alive,User-Agent,X-Mx-ReqToken,X-Data-Type,X-Auth-Token,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line highlighted"><span style="color:#BABED8;">        </span><span style="color:#FFCB6B;">add_header</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Access-Control-Expose-Headers</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Content-Length,Content-Range</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line highlighted"><wbr></span>
<span class="line highlighted"><span style="color:#BABED8;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;">$request_method = </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">OPTIONS</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line highlighted"><span style="color:#BABED8;">                </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">204</span><span style="color:#89DDFF;">;</span></span>
<span class="line highlighted"><span style="color:#BABED8;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line highlighted"><wbr></span>
<span class="line highlighted"><span style="color:#BABED8;">        </span><span style="color:#FFCB6B;">proxy_set_header</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">origin</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#FFCB6B;">proxy_pass</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">http://192.168.10.11:8000</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    }</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="åŠ¨æ€è·¯ç”±" tabindex="-1">åŠ¨æ€è·¯ç”± <a class="header-anchor" href="#åŠ¨æ€è·¯ç”±" aria-label="Permalink to &quot;åŠ¨æ€è·¯ç”±&quot;">â€‹</a></h3><p>âš¡ä¾‹å¦‚<code>vue</code>é¡¹ç›®ä¸­ä½¿ç”¨åŠ¨æ€è·¯ç”±ï¼Œé€šå¸¸é…ç½®åœ¨é¡µé¢åˆ·æ–°åä¼šè·å–ä¸åˆ°èµ„æº</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#FFCB6B;">location</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">root</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/usr/share/nginx/html/dist</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">index</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">index.html</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">index.htm</span><span style="color:#89DDFF;">;</span></span>
<span class="line highlighted"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">try_files</span><span style="color:#BABED8;"> $uri $uri</span><span style="color:#C3E88D;">/</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/index.html</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="streamå››å±‚ä»£ç†" tabindex="-1">streamå››å±‚ä»£ç† <a class="header-anchor" href="#streamå››å±‚ä»£ç†" aria-label="Permalink to &quot;streamå››å±‚ä»£ç†&quot;">â€‹</a></h2><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># ä¸»è¦ç”¨äºå››å±‚ä»£ç†çš„é…ç½®ï¼Œæ¯”å¦‚æ•°æ®åº“ç­‰</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># syntax:	stream { ... }</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># default:	â€”</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># context:	main</span></span>
<span class="line"><span style="color:#FFCB6B;">stream</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># æ˜¯å¦å¼€å¯tcp_nodelay,è¡¨ç¤ºæ”¶åˆ°æ•°æ®åŒ…åå°½å¿«å‘é€å‡ºå»</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># syntax:	tcp_nodelay on | off;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># default:	</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># tcp_nodelay on;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># Context:	stream, server</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">tcp_nodelay</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">on</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="upstream-1" tabindex="-1">upstream <a class="header-anchor" href="#upstream-1" aria-label="Permalink to &quot;upstream&quot;">â€‹</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># ç”¨äºå®šä¹‰å¯ä»¥ç”±proxy_passæŒ‡ä»¤å¼•ç”¨çš„æœåŠ¡å™¨ç»„, å¯ä»¥æŒ‡å®šæœåŠ¡èŠ‚ç‚¹çš„åœ°å€å’Œç›¸å…³çš„å‚æ•°, æœåŠ¡å™¨åœ°å€å¯ä»¥æ˜¯å¸¦ç«¯å£çš„åŸŸåæˆ–è€…ipåœ°å€ã€unixå¥—æ¥å­—è·¯å¾„, å‚æ•°å¯ä»¥è®¾ç½®æœåŠ¡æƒé‡ã€å¥åº·æ£€æŸ¥ç­‰</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># module: ngx_stream_upstream_module</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># syntax:	server address [parameters];</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># default:	â€”</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># context:	stream</span></span>
<span class="line"><span style="color:#FFCB6B;">upstream</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">backend</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">server</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">db1.example.com:13306</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">weight=</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">server</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">127.0</span><span style="color:#C3E88D;">.0.1:13306</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">max_fails=</span><span style="color:#F78C6C;">3</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">fail_timeout=</span><span style="color:#F78C6C;">30</span><span style="color:#C3E88D;">s</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">server</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">unix:/tmp/backend2</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">server</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">db2.example.com:13306</span><span style="color:#BABED8;">  </span><span style="color:#C3E88D;">backup</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="server-1" tabindex="-1">server <a class="header-anchor" href="#server-1" aria-label="Permalink to &quot;server&quot;">â€‹</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">server</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># æŒ‡å®šç›‘å¬çš„ç«¯å£åè®®ç­‰</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># syntax:	listen address:port [ssl] [udp] [proxy_protocol] [fastopen=number] [backlog=number] [rcvbuf=size] [sndbuf=size] [bind] [ipv6only=on|off] [reuseport] [so_keepalive=on|off|[keepidle]:[keepintvl]:[keepcnt]];</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># default:	â€”</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># context:	server</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">listen</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">60001</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># å’Œåç«¯æœåŠ¡å»ºç«‹è¿æ¥çš„è¶…æ—¶æ—¶é—´</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># module:   ngx_stream_proxy_module</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># syntax:	proxy_connect_timeout time;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># default:	proxy_connect_timeout 60s;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># context:	stream, server</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">proxy_connect_timeout</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#C3E88D;">s</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># è®¾ç½®å®¢æˆ·ç«¯æˆ–ä»£ç†æœåŠ¡å™¨ä¸Šä¸¤ä¸ªè¿ç»­è¯»å–æˆ–å†™å…¥æ“ä½œä¹‹é—´çš„è¶…æ—¶æ—¶é—´, å¦‚æœåœ¨æ­¤æ—¶é—´å†…æœªä¼ è¾“ä»»ä½•æ•°æ®, è¿æ¥å°†hä¼šå…³é—­ã€‚</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># syntax:	proxy_timeout timeout;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># default:	proxy_timeout 10m;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># context:	stream, server</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">proxy_timeout</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">30</span><span style="color:#C3E88D;">s</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># </span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># syntax:	proxy_pass address;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># default:	â€”</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;"># context:	server</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">proxy_pass</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">backend</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h3 id="æ—¥å¿—é…ç½®-1" tabindex="-1">æ—¥å¿—é…ç½® <a class="header-anchor" href="#æ—¥å¿—é…ç½®-1" aria-label="Permalink to &quot;æ—¥å¿—é…ç½®&quot;">â€‹</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># è®¾ç½®å››å±‚ä»£ç†çš„æ—¥å¿—æ ¼å¼</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># syntax:	log_format name [escape=default|json|none] string ...;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># default:	â€”</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># context:	stream</span></span>
<span class="line"><span style="color:#FFCB6B;">log_format</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">l4log</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">$remote_addr [$time_local] </span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#BABED8;">                 </span><span style="color:#FFCB6B;">&#39;$protocol $status $bytes_sent $bytes_received &#39;</span></span>
<span class="line"><span style="color:#BABED8;">                 </span><span style="color:#FFCB6B;">&#39;$session_time &quot;$upstream_addr&quot; &#39;</span></span>
<span class="line"><span style="color:#BABED8;">                 </span><span style="color:#FFCB6B;">&#39;&quot;$upstream_bytes_sent&quot; &quot;$upstream_bytes_received&quot; &quot;$upstream_connect_time&quot;&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Syntax:	access_log path format [buffer=size] [gzip[=level]] [flush=time] [if=condition];</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">#        	access_log off;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># default:	access_log off;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># context:	stream, server</span></span>
<span class="line"><span style="color:#FFCB6B;">access_log</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/var/log/nginx/access.log</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">l4log</span><span style="color:#89DDFF;">;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h2 id="è´Ÿè½½å‡è¡¡ç®—æ³•" tabindex="-1">è´Ÿè½½å‡è¡¡ç®—æ³• <a class="header-anchor" href="#è´Ÿè½½å‡è¡¡ç®—æ³•" aria-label="Permalink to &quot;è´Ÿè½½å‡è¡¡ç®—æ³•&quot;">â€‹</a></h2><h3 id="è½®è¯¢" tabindex="-1">è½®è¯¢ <a class="header-anchor" href="#è½®è¯¢" aria-label="Permalink to &quot;è½®è¯¢&quot;">â€‹</a></h3><p>è½®è¯¢(Round Robin): é»˜è®¤ç®—æ³•,è¯·æ±‚ä¼šä¾æ¬¡è½¬å‘åˆ°åç«¯æœåŠ¡èŠ‚ç‚¹</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># module:   ngx_http_upstream_module</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># context:	upstream</span></span>
<span class="line"><span style="color:#FFCB6B;">upstream</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">backend</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">server</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.10.100:8080</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">server</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.10.101:8080</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="åŠ æƒè½®è¯¢" tabindex="-1">åŠ æƒè½®è¯¢ <a class="header-anchor" href="#åŠ æƒè½®è¯¢" aria-label="Permalink to &quot;åŠ æƒè½®è¯¢&quot;">â€‹</a></h3><p>åŠ æƒè½®è¯¢(Weight): å³weightè¶Šå¤§, åˆ†é…åˆ°çš„è¿æ¥è¶Šå¤š</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># module:   ngx_http_upstream_module</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># context:	upstream</span></span>
<span class="line"><span style="color:#FFCB6B;">upstream</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">backend</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">server</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.10.100:8080</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">weight=</span><span style="color:#F78C6C;">4</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">server</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.10.101:8080</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="æœ€å°‘è¿æ¥" tabindex="-1">æœ€å°‘è¿æ¥ <a class="header-anchor" href="#æœ€å°‘è¿æ¥" aria-label="Permalink to &quot;æœ€å°‘è¿æ¥&quot;">â€‹</a></h3><p>æœ€å°‘è¿æ¥ç®—æ³•(Least Connections): ä¼˜å…ˆå°†è¯·æ±‚è½¬å‘åˆ°è¿æ¥æ•°å°‘çš„æœåŠ¡èŠ‚ç‚¹</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># module:   ngx_http_upstream_module</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># syntax:	least_conn;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># default:	â€”</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># context:	upstream</span></span>
<span class="line"><span style="color:#FFCB6B;">upstream</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">backend</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">least_conn</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">server</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.10.100:8080</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">server</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.10.101:8080</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="å“ˆå¸Œ" tabindex="-1">å“ˆå¸Œ <a class="header-anchor" href="#å“ˆå¸Œ" aria-label="Permalink to &quot;å“ˆå¸Œ&quot;">â€‹</a></h3><p>å“ˆå¸Œ(hash): åŸºäºhashçš„è°ƒåº¦ç®—æ³•, è®¡ç®—keyçš„å“ˆå¸Œå€¼, æ ¹æ®è®¡ç®—ç»“æœå°†è¯·æ±‚è½¬å‘è‡³ç‰¹å®šçš„æœåŠ¡èŠ‚ç‚¹</p><p>ç®—æ³•:<code>hash(key) % node_counts = index</code></p><p>å€¼å¾—æ³¨æ„çš„æ˜¯å½“node_counts(èŠ‚ç‚¹æ•°é‡)å‘ç”Ÿå˜åŒ–æ—¶, index(æœåŠ¡èŠ‚ç‚¹ç´¢å¼•)ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># module:   ngx_http_upstream_module</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># syntax:	hash key;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># default:	â€”</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># context:	upstream</span></span>
<span class="line"><span style="color:#FFCB6B;">upstream</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">backend</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#82AAFF;">hash</span><span style="color:#BABED8;"> $request_uri</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">server</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.10.100:8080</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">server</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.10.101:8080</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="ipå“ˆå¸Œ" tabindex="-1">IPå“ˆå¸Œ <a class="header-anchor" href="#ipå“ˆå¸Œ" aria-label="Permalink to &quot;IPå“ˆå¸Œ&quot;">â€‹</a></h3><p>IPå“ˆå¸Œ(IP Hash): åŸºäºè¯·æ±‚çš„å®¢æˆ·ç«¯ipçš„hashå€¼, ç¡®ä¿æ¥è‡ªåŒä¸€å®¢æˆ·ç«¯çš„è¯·æ±‚å°†å§‹ç»ˆè½¬å‘åˆ°åŒä¸€æœåŠ¡èŠ‚ç‚¹, ä¸€èˆ¬ç”¨äºä¼šè¯ä¿æŒ</p><p>ç®—æ³•:<code>hash(client_ip) % node_counts = index</code></p><p>å€¼å¾—æ³¨æ„çš„æ˜¯å½“node_counts(èŠ‚ç‚¹æ•°é‡)å‘ç”Ÿå˜åŒ–æ—¶, index(æœåŠ¡èŠ‚ç‚¹ç´¢å¼•)ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># module:   ngx_http_upstream_module</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># syntax:	ip_hash;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># default:	â€”</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># context:	upstream</span></span>
<span class="line"><span style="color:#FFCB6B;">upstream</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">backend</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">ip_hash</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">server</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.10.100:8080</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">server</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.10.101:8080</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="ä¸€è‡´æ€§å“ˆå¸Œ" tabindex="-1">ä¸€è‡´æ€§å“ˆå¸Œ <a class="header-anchor" href="#ä¸€è‡´æ€§å“ˆå¸Œ" aria-label="Permalink to &quot;ä¸€è‡´æ€§å“ˆå¸Œ&quot;">â€‹</a></h3><p>ä¸€è‡´æ€§å“ˆå¸Œ(Consistent Hash): åœ¨ä¸Šè¿°å“ˆå¸Œç®—æ³•ä¸­, å¦‚æœæœ‰å¤§é‡çš„è¯·æ±‚è°ƒåº¦åˆ°æŸä¸€æœåŠ¡èŠ‚ç‚¹, è€ŒæŸäº›æœåŠ¡èŠ‚ç‚¹ä¸å¯ç”¨æˆ–è€…æ–°å¢æœåŠ¡èŠ‚ç‚¹å¯¼è‡´æœåŠ¡èŠ‚ç‚¹æ•°é‡å˜åŒ–, åˆ™è¯¥ç®—æ³•ä¼šé‡æ–°è®¡ç®—ç»“æœ, ä»è€Œé€ æˆå¤§é‡çš„è¯·æ±‚è¢«è½¬ç§»å…¶ä»–èŠ‚ç‚¹å¤„ç†, åˆ™ä¼šè¯å¤±æ•ˆ, éœ€è¦å®¢æˆ·ç«¯é‡æ–°å»ºç«‹å›è¯ä¿æŒ; ä¸ºè§£å†³ä¸Šè¿°é—®é¢˜, å°±éœ€è¦ä½¿ç”¨ä¸€è‡´æ€§å“ˆå¸Œ</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># module:   ngx_http_upstream_module</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># syntax:	hash key consistent;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># default:	â€”</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># context:	upstream</span></span>
<span class="line"><span style="color:#FFCB6B;">upstream</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">backend01</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#82AAFF;">hash</span><span style="color:#BABED8;"> $remote_addr </span><span style="color:#C3E88D;">consistent</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">server</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.10.100:8080</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">server</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">192.168</span><span style="color:#C3E88D;">.10.101:8080</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div>`,83),t=[e];function o(r,c,i,y,B,b){return n(),a("div",null,t)}const m=s(p,[["render",o]]);export{u as __pageData,m as default};
