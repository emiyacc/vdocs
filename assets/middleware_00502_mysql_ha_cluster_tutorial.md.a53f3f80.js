import{_ as s,o as n,c as a,Q as l}from"./chunks/framework.eabe3503.js";const E=JSON.parse('{"title":"mysqlåŒä¸»æ¨¡å¼éƒ¨ç½²","description":"","frontmatter":{"title":"mysqlåŒä¸»æ¨¡å¼éƒ¨ç½²","createTime":"2024/03/21 15:29:31","updateTime":"2024/03/21 18:16:48","isPublished":true,"tags":["mysql"]},"headers":[],"relativePath":"middleware/00502_mysql_ha_cluster_tutorial.md","filePath":"middleware/00502_mysql_ha_cluster_tutorial.md"}'),p={name:"middleware/00502_mysql_ha_cluster_tutorial.md"},e=l(`<h2 id="ç¯å¢ƒè¯´æ˜" tabindex="-1">ç¯å¢ƒè¯´æ˜ <a class="header-anchor" href="#ç¯å¢ƒè¯´æ˜" aria-label="Permalink to &quot;ç¯å¢ƒè¯´æ˜&quot;">â€‹</a></h2><table><thead><tr><th>role</th><th>ip</th><th>version</th></tr></thead><tbody><tr><td>master01</td><td>192.168.10.12</td><td>mysql-5.7.21 keepalived</td></tr><tr><td>master02</td><td>192.168.10.13</td><td>mysql-5.7.21 keepalived</td></tr><tr><td>vip</td><td>192.168.10.15</td><td></td></tr></tbody></table><h2 id="mysqlåˆå§‹åŒ–é…ç½®" tabindex="-1">mysqlåˆå§‹åŒ–é…ç½® <a class="header-anchor" href="#mysqlåˆå§‹åŒ–é…ç½®" aria-label="Permalink to &quot;mysqlåˆå§‹åŒ–é…ç½®&quot;">â€‹</a></h2><p>æœ¬æ¬¡ç¤ºä¾‹é‡‡ç”¨äºŒè¿›åˆ¶çš„æ–¹å¼éƒ¨ç½²ğŸ‘‰ <a href="https://downloads.mysql.com/archives/community/" target="_blank" rel="noreferrer">å®˜ç½‘ä¸‹è½½åœ°å€</a></p><p>âš¡ <code>master01</code>å’Œ<code>master02</code>ä¸Šéƒ½è¦æ‰§è¡Œ</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># wget https://cdn.mysql.com/archives/mysql-5.7/mysql-5.7.21-linux-glibc2.12-x86_64.tar.gz</span></span>
<span class="line"><span style="color:#FFCB6B;">useradd</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">mysql</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-s</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/sbin/nologin</span></span>
<span class="line"><span style="color:#FFCB6B;">mkdir</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/workspace/mysql/{data,logs,temp}</span></span>
<span class="line"><span style="color:#FFCB6B;">chown</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">mysql.mysql</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-R</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/workspace/mysql</span></span>
<span class="line"><span style="color:#FFCB6B;">tar</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-zxvf</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">mysql-5.7.21-linux-glibc2.12-x86_64.tar.gz</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-C</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/opt/</span></span>
<span class="line"><span style="color:#FFCB6B;">ln</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-s</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/opt/mysql-5.7.21-linux-glibc2.12-x86_64</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/usr/local/mysql</span></span>
<span class="line"><span style="color:#FFCB6B;">ln</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-s</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/usr/local/mysql/lib</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/usr/lib/mysql</span></span>
<span class="line"><span style="color:#FFCB6B;">ln</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-s</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/usr/local/mysql/include/mysql</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/usr/include/mysql</span></span>
<span class="line"><span style="color:#FFCB6B;">ln</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-s</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/usr/local/mysql/bin/mysql</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/usr/local/bin/mysql</span></span>
<span class="line"><span style="color:#FFCB6B;">ln</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-s</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/usr/local/mysql/bin/mysqlbinlog</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/usr/local/bin/mysqlbinlog</span></span>
<span class="line"><span style="color:#FFCB6B;">ln</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-s</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/usr/local/mysql/bin/mysqldump</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/usr/local/bin/mysqldump</span></span>
<span class="line"><span style="color:#FFCB6B;">ln</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-s</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/usr/local/mysql/support-files/mysql.server</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">/etc/init.d/mysqld</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h2 id="mysqlèŠ‚ç‚¹é…ç½®" tabindex="-1">mysqlèŠ‚ç‚¹é…ç½® <a class="header-anchor" href="#mysqlèŠ‚ç‚¹é…ç½®" aria-label="Permalink to &quot;mysqlèŠ‚ç‚¹é…ç½®&quot;">â€‹</a></h2><p>step01 ä¿®æ”¹<code>/etc/my.cnf</code>, masterèŠ‚ç‚¹éœ€è¦å¼€å¯<code>binlog</code>,<code>gtid</code>,<code>relay log</code></p><p>âš¡ <code>master01</code>å’Œ<code>master02</code>ä¸Šéƒ½è¦æ‰§è¡Œï¼Œä¸¤ä¸ªèŠ‚ç‚¹çš„<code>server-id</code>å’Œ<code>auto-increment-offset</code>è¦è®¾ç½®æˆä¸åŒçš„å€¼</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#89DDFF;">[</span><span style="color:#BABED8;">client</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">port</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">3306</span></span>
<span class="line"><span style="color:#BABED8;">socket</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/workspace/mysql/logs/mysqld.sock</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">[</span><span style="color:#BABED8;">mysqld</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># server idéœ€è¦å”¯ä¸€</span></span>
<span class="line highlighted"><span style="color:#BABED8;">server-id</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#BABED8;">port</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">3306</span></span>
<span class="line"><span style="color:#BABED8;">user</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">mysql</span></span>
<span class="line"><span style="color:#BABED8;">socket</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/workspace/mysql/logs/mysqld.sock</span></span>
<span class="line"><span style="color:#BABED8;">pid-file</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/workspace/mysql/logs/mysqld.pid</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">basedir</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/usr/local/mysql</span></span>
<span class="line"><span style="color:#BABED8;">datadir</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/workspace/mysql/data</span></span>
<span class="line"><span style="color:#BABED8;">tmpdir</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/workspace/mysql/temp</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">default-storage-engine</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">INNODB</span></span>
<span class="line"><span style="color:#BABED8;">log-error</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/workspace/mysql/logs/error.log</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">character-set-server</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">utf8mb4</span></span>
<span class="line"><span style="color:#BABED8;">collation-server</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">utf8mb4_unicode_ci</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">max-connections</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">200</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># å¼€å¯binglog</span></span>
<span class="line"><span style="color:#BABED8;">log-bin</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/workspace/mysql/logs/mysql-bin</span></span>
<span class="line"><span style="color:#BABED8;">sync-binlog</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># å¼€å¯å­˜å‚¨è¿‡ç¨‹ã€å‡½æ•°ã€è§¦å‘å™¨ç­‰å†…å®¹çš„åŒæ­¥åŠŸèƒ½</span></span>
<span class="line"><span style="color:#BABED8;">log-bin-trust-function-creators</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#BABED8;">binlog-format</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">ROW</span></span>
<span class="line"><span style="color:#BABED8;">max-binlog-size</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">256</span><span style="color:#C3E88D;">M</span></span>
<span class="line"><span style="color:#BABED8;">expire-logs-days</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">30</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># å¼€å¯GTIDå¤åˆ¶,å³slaveåŒæ­¥æ—¶ä¸éœ€è¦è®¾ç½®masterçš„binlogå’Œposition</span></span>
<span class="line"><span style="color:#BABED8;">gtid-mode</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">on</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># è·³è¿‡ä¸€äº›å¯èƒ½å¯¼è‡´æ‰§è¡Œå‡ºé”™çš„SQLè¯­å¥</span></span>
<span class="line"><span style="color:#BABED8;">enforce-gtid-consistency</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># å¼€å¯relay log</span></span>
<span class="line"><span style="color:#BABED8;">relay-log</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/workspace/mysql/logs/relay-bin</span></span>
<span class="line"><span style="color:#BABED8;">relay-log-index</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">/workspace/mysql/logs/relay-bin.index</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># åŒæ­¥æ‰§è¡Œè·³è¿‡ä¸€äº›é”™è¯¯ç </span></span>
<span class="line"><span style="color:#BABED8;">slave-skip-errors</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1062</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># å¿½ç•¥åŒæ­¥åº“</span></span>
<span class="line"><span style="color:#BABED8;">replicate-ignore-db</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">mysql</span><span style="color:#BABED8;"> </span></span>
<span class="line"><span style="color:#BABED8;">replicate-ignore-db</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">information_schema</span></span>
<span class="line"><span style="color:#BABED8;">replicate-ignore-db</span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;">performance_schema</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># è®¾ç½®è‡ªå¢åºåˆ—,2ä¸ªèŠ‚ç‚¹çš„åˆå§‹å€¼å³offsetåˆ†ä¸ºè®¾ç½®1,2</span></span>
<span class="line highlighted"><span style="color:#BABED8;">auto-increment-offset</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#BABED8;">auto-increment-increment</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">2</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><p>step02 åˆå§‹åŒ–æ•°æ®åº“ï¼Œå¹¶å¯åŠ¨<code>mysqld</code>æœåŠ¡</p><p>âš¡ <code>master01</code>å’Œ<code>master02</code>ä¸Šéƒ½è¦æ‰§è¡Œ</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">/usr/local/mysql/bin/mysqld</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">--initialize-insecure</span></span>
<span class="line"><span style="color:#FFCB6B;">chkconfig</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">--add</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">mysqld</span></span>
<span class="line"><span style="color:#FFCB6B;">chkconfig</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">mysqld</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">on</span></span>
<span class="line"><span style="color:#FFCB6B;">service</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">mysqld</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">start</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>step03 è®¾ç½®<code>mysql</code>çš„<code>root</code>å¯†ç ï¼Œå¹¶åˆ›å»ºç”¨äºåŒæ­¥æ•°æ®çš„è´¦å·<code>repl</code></p><p>âš¡ åªåœ¨<code>master01</code>ä¸Šæ‰§è¡Œ</p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">alter</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">user</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">root</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">@</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">localhost</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;"> identified </span><span style="color:#F78C6C;">with</span><span style="color:#BABED8;"> mysql_native_password </span><span style="color:#F78C6C;">by</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">root</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">create</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">user</span><span style="color:#BABED8;"> &quot;</span><span style="color:#82AAFF;">repl</span><span style="color:#BABED8;">&quot;@</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">192.168.10.%</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;"> identified </span><span style="color:#F78C6C;">by</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">testfind</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">grant</span><span style="color:#BABED8;"> replication slave </span><span style="color:#F78C6C;">on</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;">.</span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">to</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">repl</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">@</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">192.168.10.%</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">flush privileges;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="è®¾ç½®ä¸»ä»åŒæ­¥" tabindex="-1">è®¾ç½®ä¸»ä»åŒæ­¥ <a class="header-anchor" href="#è®¾ç½®ä¸»ä»åŒæ­¥" aria-label="Permalink to &quot;è®¾ç½®ä¸»ä»åŒæ­¥&quot;">â€‹</a></h2><p>åŒä¸»æ¨¡å¼å³ä¸¤ä¸ªèŠ‚ç‚¹äº’ä¸ºä¸»ä»</p><p>âš¡ åœ¨<code>master02</code>ä¸Šæ‰§è¡Œ</p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">-- master02ä¸Šæ‰§è¡Œå‘½ä»¤è¡Œï¼Œå°†master01è®¾ç½®ä¸ºè‡ªå·±çš„ä¸»æœºç‚¹</span></span>
<span class="line"><span style="color:#BABED8;">change </span><span style="color:#F78C6C;">master</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">to</span><span style="color:#BABED8;"> master_host</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">192.168.10.12</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">,master_user</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">repl</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">, master_password</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">testfind</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">,master_port</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">3306</span><span style="color:#BABED8;">,master_auto_position</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- å¼€å¯slaveåŒæ­¥çº¿ç¨‹</span></span>
<span class="line"><span style="color:#F78C6C;">start</span><span style="color:#BABED8;"> slave;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- æŸ¥çœ‹slaveèŠ‚ç‚¹è¿æ¥çŠ¶æ€ï¼Œä¸»è¦å…³æ³¨ Slave_IO_Running å’Œ Slave_SQL_Running çš„å€¼</span></span>
<span class="line"><span style="color:#BABED8;">show slave </span><span style="color:#F78C6C;">status</span><span style="color:#BABED8;"> \\G;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>âš¡ åœ¨<code>master01</code>ä¸Šæ‰§è¡Œ</p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">-- master01ä¸Šæ‰§è¡Œå‘½ä»¤è¡Œï¼Œå°†master02è®¾ç½®ä¸ºè‡ªå·±çš„ä¸»æœºç‚¹</span></span>
<span class="line"><span style="color:#BABED8;">change </span><span style="color:#F78C6C;">master</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">to</span><span style="color:#BABED8;"> master_host</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">192.168.10.13</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">,master_user</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">repl</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">, master_password</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">testfind</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">,master_port</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">3306</span><span style="color:#BABED8;">,master_auto_position</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- å¼€å¯slaveåŒæ­¥çº¿ç¨‹</span></span>
<span class="line"><span style="color:#F78C6C;">start</span><span style="color:#BABED8;"> slave;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">-- æŸ¥çœ‹slaveèŠ‚ç‚¹è¿æ¥çŠ¶æ€ï¼Œä¸»è¦å…³æ³¨ Slave_IO_Running å’Œ Slave_SQL_Running çš„å€¼</span></span>
<span class="line"><span style="color:#BABED8;">show slave </span><span style="color:#F78C6C;">status</span><span style="color:#BABED8;"> \\G;</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h2 id="æµ‹è¯•æ•°æ®åŒæ­¥" tabindex="-1">æµ‹è¯•æ•°æ®åŒæ­¥ <a class="header-anchor" href="#æµ‹è¯•æ•°æ®åŒæ­¥" aria-label="Permalink to &quot;æµ‹è¯•æ•°æ®åŒæ­¥&quot;">â€‹</a></h2><p>âš¡ åœ¨å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹ä¸Šåˆ›å»ºæ•°æ®åº“ã€è¡¨å¹¶ä¸”æ’å…¥æ•°æ®</p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">create</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">database</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">if</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">not</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">exists</span><span style="color:#BABED8;"> db01;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">use</span><span style="color:#BABED8;"> db01;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">create</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">table</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">if</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">not</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">exists</span><span style="color:#BABED8;"> tb01(id </span><span style="color:#C792EA;">int</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">primary key</span><span style="color:#BABED8;">, </span><span style="color:#F78C6C;">data</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">varchar</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">32</span><span style="color:#BABED8;">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">insert into</span><span style="color:#BABED8;"> tb01 </span><span style="color:#F78C6C;">values</span><span style="color:#BABED8;">(</span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">tom</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">),(</span><span style="color:#F78C6C;">2</span><span style="color:#BABED8;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">jerry</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;">);</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>âš¡ åœ¨å¦ä¸€ä¸ªèŠ‚ç‚¹ä¸ŠæŸ¥çœ‹æ˜¯å¦æœ‰æ•°æ®</p><div class="language-sql line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">select</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">*</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">from</span><span style="color:#BABED8;"> db01.tb01;</span></span>
<span class="line"><span style="color:#BABED8;"># </span><span style="color:#89DDFF;">+</span><span style="color:#676E95;font-style:italic;">----+-------+</span></span>
<span class="line"><span style="color:#BABED8;"># | id | </span><span style="color:#F78C6C;">data</span><span style="color:#BABED8;">  |</span></span>
<span class="line"><span style="color:#BABED8;"># </span><span style="color:#89DDFF;">+</span><span style="color:#676E95;font-style:italic;">----+-------+</span></span>
<span class="line"><span style="color:#BABED8;"># |  </span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;"> | tom   |</span></span>
<span class="line"><span style="color:#BABED8;"># |  </span><span style="color:#F78C6C;">2</span><span style="color:#BABED8;"> | jerry |</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="å®‰è£…keepalived" tabindex="-1">å®‰è£…keepalived <a class="header-anchor" href="#å®‰è£…keepalived" aria-label="Permalink to &quot;å®‰è£…keepalived&quot;">â€‹</a></h2><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">yum</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">install</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-y</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">keepalived</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="keepalivedé…ç½®" tabindex="-1">keepalivedé…ç½® <a class="header-anchor" href="#keepalivedé…ç½®" aria-label="Permalink to &quot;keepalivedé…ç½®&quot;">â€‹</a></h3><p>âš¡ <code>master01</code>èŠ‚ç‚¹<code>/etc/keepalived/keepalived.conf</code></p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#FFCB6B;">global_defs</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line highlighted"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">router_id</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">master01</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span>
<span class="line"><span style="color:#FFCB6B;">vrrp_script</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">check_mysqld</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">script</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">service mysqld status</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">interval</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">2</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">weight</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-2</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">timeout</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">fall</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">2</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">rise</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">2</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span>
<span class="line"><span style="color:#FFCB6B;">vrrp_instance</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">VI_1</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line highlighted"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">state</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">MASTER</span><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;">#è®¾ç½®ä¸ºä¸»æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">interface</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">ens33</span><span style="color:#BABED8;">  </span><span style="color:#676E95;font-style:italic;">#ç›‘æµ‹ç½‘ç»œæ¥å£</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">virtual_router_id</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">200</span><span style="color:#BABED8;">  </span><span style="color:#676E95;font-style:italic;">#ä¸»ã€å¤‡å¿…é¡»ä¸€æ ·</span></span>
<span class="line highlighted"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">priority</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">100</span><span style="color:#BABED8;">   </span><span style="color:#676E95;font-style:italic;">#(ä¸»ã€å¤‡æœºå–ä¸åŒçš„ä¼˜å…ˆçº§ï¼Œä¸»æœºå€¼è¾ƒå¤§ï¼Œå¤‡ä»½æœºå€¼è¾ƒå°,å€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜)</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">advert_int</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;">   </span><span style="color:#676E95;font-style:italic;">#VRRP Multicastå¹¿æ’­å‘¨æœŸç§’æ•°</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">authentication</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">       </span><span style="color:#FFCB6B;">auth_type</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">PASS</span><span style="color:#BABED8;">  </span><span style="color:#676E95;font-style:italic;">#VRRPè®¤è¯æ–¹å¼ï¼Œä¸»å¤‡å¿…é¡»ä¸€è‡´</span></span>
<span class="line"><span style="color:#BABED8;">       </span><span style="color:#FFCB6B;">auth_pass</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">testfind</span><span style="color:#BABED8;">   </span><span style="color:#676E95;font-style:italic;">#(å¯†ç )</span></span>
<span class="line"><span style="color:#BABED8;">    }</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">virtual_ipaddress</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">       </span><span style="color:#FFCB6B;">192.168.10.15</span><span style="color:#BABED8;">  </span><span style="color:#676E95;font-style:italic;">#VRRP HAè™šæ‹Ÿåœ°å€</span></span>
<span class="line"><span style="color:#BABED8;">    }</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">track_script</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#FFCB6B;">check_mysqld</span></span>
<span class="line"><span style="color:#BABED8;">    }</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>âš¡ <code>master02</code>èŠ‚ç‚¹<code>/etc/keepalived/keepalived.conf</code></p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight has-highlighted-lines"><code><span class="line"><span style="color:#FFCB6B;">global_defs</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line highlighted"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">router_id</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">master02</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span>
<span class="line"><span style="color:#FFCB6B;">vrrp_script</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">check_mysqld</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">script</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">service mysqld status</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">interval</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">2</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">weight</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-2</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">timeout</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">fall</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">2</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">rise</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">2</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span>
<span class="line"><span style="color:#FFCB6B;">vrrp_instance</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">VI_1</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line highlighted"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">state</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">BACKUP</span><span style="color:#BABED8;">    </span><span style="color:#676E95;font-style:italic;">#è®¾ç½®ä¸ºä¸»æœåŠ¡å™¨</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">interface</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">ens33</span><span style="color:#BABED8;">  </span><span style="color:#676E95;font-style:italic;">#ç›‘æµ‹ç½‘ç»œæ¥å£</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">virtual_router_id</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">200</span><span style="color:#BABED8;">  </span><span style="color:#676E95;font-style:italic;">#ä¸»ã€å¤‡å¿…é¡»ä¸€æ ·</span></span>
<span class="line highlighted"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">priority</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">99</span><span style="color:#BABED8;">   </span><span style="color:#676E95;font-style:italic;">#(ä¸»ã€å¤‡æœºå–ä¸åŒçš„ä¼˜å…ˆçº§ï¼Œä¸»æœºå€¼è¾ƒå¤§ï¼Œå¤‡ä»½æœºå€¼è¾ƒå°,å€¼è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜)</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">advert_int</span><span style="color:#BABED8;"> </span><span style="color:#F78C6C;">1</span><span style="color:#BABED8;">   </span><span style="color:#676E95;font-style:italic;">#VRRP Multicastå¹¿æ’­å‘¨æœŸç§’æ•°</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">authentication</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">       </span><span style="color:#FFCB6B;">auth_type</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">PASS</span><span style="color:#BABED8;">  </span><span style="color:#676E95;font-style:italic;">#VRRPè®¤è¯æ–¹å¼ï¼Œä¸»å¤‡å¿…é¡»ä¸€è‡´</span></span>
<span class="line"><span style="color:#BABED8;">       </span><span style="color:#FFCB6B;">auth_pass</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">testfind</span><span style="color:#BABED8;">   </span><span style="color:#676E95;font-style:italic;">#(å¯†ç )</span></span>
<span class="line"><span style="color:#BABED8;">    }</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">virtual_ipaddress</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">       </span><span style="color:#FFCB6B;">192.168.10.15</span><span style="color:#BABED8;">  </span><span style="color:#676E95;font-style:italic;">#VRRP HAè™šæ‹Ÿåœ°å€</span></span>
<span class="line"><span style="color:#BABED8;">    }</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#FFCB6B;">track_script</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">{</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#FFCB6B;">check_mysqld</span></span>
<span class="line"><span style="color:#BABED8;">    }</span></span>
<span class="line"><span style="color:#BABED8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>âš¡ å¯åŠ¨<code>keepalived</code>æœåŠ¡å¹¶è®¾ç½®å¼€æœºè‡ªå¯</p><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">enable</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">--now</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">keepalived</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br></div></div><h3 id="æµ‹è¯•éªŒè¯" tabindex="-1">æµ‹è¯•éªŒè¯ <a class="header-anchor" href="#æµ‹è¯•éªŒè¯" aria-label="Permalink to &quot;æµ‹è¯•éªŒè¯&quot;">â€‹</a></h3><div class="language-shell line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">#åœ¨master01èŠ‚ç‚¹ä¸Šåœæ­¢mysqlæœåŠ¡</span></span>
<span class="line"><span style="color:#FFCB6B;">service</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">mysqld</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">stop</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># æŸ¥çœ‹ç½‘å¡ip</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># æŸ¥çœ‹keepalivedæœåŠ¡æ—¥å¿—ï¼Œå¯ä»¥å‘ç°master01èŠ‚ç‚¹å¥åº·æ£€æŸ¥å¤±è´¥ï¼Œä¼˜å…ˆçº§é™ä½ï¼Œå·²ç»åˆ‡æ¢ä¸ºBACKUP</span></span>
<span class="line"><span style="color:#FFCB6B;">journalctl</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-u</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">keepalived</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">--since</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">2 min ago</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Keepalived_vrrp[7233]: /usr/sbin/service mysqld status exited with status 3</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Keepalived_vrrp[7233]: /usr/sbin/service mysqld status exited with status 3</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Keepalived_vrrp[7233]: VRRP_Script(check_mysqld) failed</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Keepalived_vrrp[7233]: VRRP_Instance(VI_1) Changing effective priority from 100 to 98</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Keepalived_vrrp[7233]: VRRP_Instance(VI_1) Received advert with higher priority 99, ours 98</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Keepalived_vrrp[7233]: VRRP_Instance(VI_1) Entering BACKUP STATE</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Keepalived_vrrp[7233]: VRRP_Instance(VI_1) removing protocol VIPs.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Keepalived_vrrp[7233]: /usr/sbin/service mysqld status exited with status 3</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># åœ¨master01èŠ‚ç‚¹ä¸Šå¯åŠ¨mysqlæœåŠ¡</span></span>
<span class="line"><span style="color:#FFCB6B;">service</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">mysqld</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">start</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># æŸ¥çœ‹keepalivedæœåŠ¡æ—¥å¿—ï¼Œå¯ä»¥å‘ç°master01èŠ‚ç‚¹å¥åº·æ£€æŸ¥æˆåŠŸï¼Œä¼˜å…ˆçº§æ¢å¤ï¼Œå·²ç»åˆ‡æ¢ä¸ºMASTER</span></span>
<span class="line"><span style="color:#FFCB6B;">journalctl</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">-u</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">keepalived</span><span style="color:#BABED8;"> </span><span style="color:#C3E88D;">--since</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">2 min ago</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Keepalived_vrrp[7233]: /usr/sbin/service mysqld status exited with status 3</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Keepalived_vrrp[7233]: VRRP_Script(check_mysqld) succeeded</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Keepalived_vrrp[7233]: VRRP_Instance(VI_1) Changing effective priority from 98 to 100</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Keepalived_vrrp[7233]: VRRP_Instance(VI_1) forcing a new MASTER election</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Keepalived_vrrp[7233]: VRRP_Instance(VI_1) Transition to MASTER STATE</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Keepalived_vrrp[7233]: VRRP_Instance(VI_1) Entering MASTER STATE</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Keepalived_vrrp[7233]: VRRP_Instance(VI_1) setting protocol VIPs.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Keepalived_vrrp[7233]: Sending gratuitous ARP on ens33 for 192.168.10.15</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Keepalived_vrrp[7233]: VRRP_Instance(VI_1) Sending/queueing gratuitous ARPs on ens33 for 192.168.10.15</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div>`,38),o=[e];function r(c,t,i,y,B,D){return n(),a("div",null,o)}const m=s(p,[["render",r]]);export{E as __pageData,m as default};
